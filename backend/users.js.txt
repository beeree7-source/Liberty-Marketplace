// Fake in-memory users (replace with database later)
let users = [];

// POST /api/users/register
const registerUser = (req, res) => {
  const { name, email, role } = req.body; // role: "retailer" or "supplier"
  if (!name || !email || !role) {
    return res.status(400).json({ error: "Missing name, email, or role" });
  }
  const user = { id: Date.now(), name, email, role, approved: role === "retailer" ? false : true };
  users.push(user);
  res.json({ message: "User registered", user });
};

// POST /api/users/:id/approve
const approveUser = (req, res) => {
  const userId = parseInt(req.params.id);
  const user = users.find(u => u.id === userId);
  if (!user) {
    return res.status(404).json({ error: "User not found" });
  }
  if (user.role !== "retailer") {
    return res.status(400).json({ error: "Only retailers need approval" });
  }
  user.approved = true;
  res.json({ message: "User approved", user });
};

module.exports = { registerUser, approveUser };
